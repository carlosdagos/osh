<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>index (osh.index)</title><link rel="stylesheet" href="../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ osh</nav><h1 id="top"><a href="#top" class="anchor"></a>Osh (OCaml Shell)</h1><p><code>Osh</code> is an OCaml library that allows shell-like scripting in OCaml programs.</p><p><i>NOTE: This library is still experimental. The API is not guaranteed to be stable.</i></p><nav class="toc"><ul><li><a href="#installing">Installing</a><ul><li><a href="#install-source">Source code</a></li><li><a href="#install-opam">Using opam</a></li></ul></li><li><a href="#fundamentals">Fundamentals</a></li><li><a href="#usage">Usage</a><ul><li><a href="#osh-basic">Using the runtime directly</a></li><li><a href="#osh-ppx">Using the Osh PPX</a><ul><li><a href="#osh-ppx-basic">Basic expressions</a></li><li><a href="#osh-def-multiple">Defining multiple <code>Osh</code> proc</a></li><li><a href="#osh-scripts">Defining scripts</a></li></ul></li></ul></li><li><a href="#acknowledgements">Acknowledgements</a></li><li><a href="#bugs">Current limitations</a></li><li><a href="#bugs">Bugs</a></li></ul></nav></header><h2 id="installing"><a href="#installing" class="anchor"></a>Installing</h2><h3 id="install-source"><a href="#install-source" class="anchor"></a>Source code</h3><p>The source code for <code>Osh</code> can be found in the following link:</p><p><a href="https://github.com/carlosdagos/osh">https://github.com/carlosdagos/osh</a></p><h3 id="install-opam"><a href="#install-opam" class="anchor"></a>Using opam</h3><p>You can install <code>Osh</code> using <code>opam</code> by following the instructions below:</p><pre>opam pin add osh https://github.com/carlosdagos/osh.git
opam install osh</pre><h2 id="fundamentals"><a href="#fundamentals" class="anchor"></a>Fundamentals</h2><p><code>Osh</code> allows OCaml programmers to define system programs and use certain combinators to build more complex ones.</p><p>The main entrypoint to run programs is the <code>run_process</code> function.</p><p>The runtime module can be found in <a href="Osh/Proc/index.html"><code>Osh.Proc</code></a>.</p><h2 id="usage"><a href="#usage" class="anchor"></a>Usage</h2><p>There's three basic ways to use <code>Osh</code></p><h3 id="osh-basic"><a href="#osh-basic" class="anchor"></a>Using the runtime directly</h3><p>Once installed you can add the library to your <code>dune</code> file.</p><pre><code class="ml">(executable
 (name my-executable)
 (modules main)
 (libraries osh))</code></pre><p>You can then use the runtime directly:</p><pre><code class="ml">open Osh.Proc

let _ =
  let echo args = create_system_process ~program:&quot;echo&quot; ~args in
  run_process' (echo [&quot;Hello world!&quot;])</code></pre><h3 id="osh-ppx"><a href="#osh-ppx" class="anchor"></a>Using the Osh PPX</h3><p>The code above is fine but can turn out to be quite vebose.</p><p>Osh comes with an Preprocessor Extension that you can use to avoid having to spell out everything.</p><p>Start out by adding the <code>preprocess</code> stanza to your <code>dune</code> file:</p><pre><code class="ml">(executable
 (name my-executable)
 (modules main)
 (libraries osh)
 (preprocess (pps osh.ppx)))</code></pre><h4 id="osh-ppx-basic"><a href="#osh-ppx-basic" class="anchor"></a>Basic expressions</h4><p>You may now create <a href="Osh/Proc/index.html#type-t"><code>Osh.Proc.t</code></a> expressions using simple PPX:</p><pre><code class="ml">open Osh.Proc

let echo = [%osh &quot;echo&quot;]
let cat  = [%osh &quot;cat&quot;]

let _ =
  run_process' (echo [&quot;Hello world!&quot;] ||&gt; cat [])</code></pre><h4 id="osh-def-multiple"><a href="#osh-def-multiple" class="anchor"></a>Defining multiple <code>Osh</code> proc</h4><p>The above might still be cumbersome if you wish to use many programs. You may instead with to use the <code>osh_def</code> extension:</p><pre><code class="ml">open Osh.Proc

[%%osh_def [&quot;echo&quot;; &quot;cat&quot;]]

let _ =
  run_process' (echo [&quot;Hello world!&quot;] ||&gt; cat [])</code></pre><h4 id="osh-scripts"><a href="#osh-scripts" class="anchor"></a>Defining scripts</h4><p>Lastly, if you wish to port complex programs using <code>Osh</code>, you might want to define your functions using the structure extension provided by this library.</p><pre><code class="ml">[%%osh_def [&quot;ip&quot;]]

let%osh_script ip_route ?(get_ip=&quot;8.8.8.8&quot;) () =
  ip [&quot;route&quot;; &quot;get&quot;; get_ip]

let _ =
  let open Osh.Proc in
  run_process' (ip_route ())
  run_process' (ip_route ~get_ip:&quot;10.0.0.1&quot; ())</code></pre><h2 id="acknowledgements"><a href="#acknowledgements" class="anchor"></a>Acknowledgements</h2><p><code>Osh</code> is based on the following Haskell projects:</p><ul><li><a href="https://github.com/luke-clifton/shh">https://github.com/luke-clifton/shh</a></li><li><a href="https://github.com/kowainik/shellmet">https://github.com/kowainik/shellmet</a></li></ul><h2 id="bugs"><a href="#bugs" class="anchor"></a>Current limitations</h2><p><code>Osh</code> does not use any async runtime under the hood. This means that the following script will never finish:</p><pre><code class="ml">let%osh_script will_never_finish =
   cat [&quot;/dev/urandom&quot;] ||&gt; head [&quot;-n&quot;, &quot;5&quot;]</code></pre><p>Support for this will be added in future versions.</p><h2 id="bugs"><a href="#bugs" class="anchor"></a>Bugs</h2><p>Please file any issues encountered in the link below:</p><p><a href="https://github.com/carlosdagos/osh/issues">https://github.com/carlosdagos/osh/issues</a></p></div></body></html>